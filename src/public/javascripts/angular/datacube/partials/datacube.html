<div class="row">

    <div class="col-lg-3">

        <!--<div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Data source</h3>
            </div>
            <div class="panel-body">
                <p>Using a fixed dataset, which is a result of a Payola analyzer.</p>
            </div>
            <div class="panel-footer"></div>
        </div>
        -->

        <p ng-show="dataStructures.length == 0">No data structures found in the supplied datasource.</p>
        <ul class="list-group" ng-show="dataStructures.length > 0">
            <li class="list-group-item active">Available data structures</li>
            <li ng-repeat="ds in dataStructures" class="list-group-item">
                <table>
                    <tr>
                        <td style="border-right: 1px solid #ddd; padding-right: 10px;">
                            <input type="checkbox" ng-model="ds.isActive" ng-change="switchDSD(ds)" />
                        </td>
                        <td style="padding-left: 10px;">
                            {{ds.label.variants[language] || "Unlabeled DSD"}}
                        </td>
                    </tr>
                </table>
            </li>
        </ul>

        <div class="panel panel-default" ng-show="datasets.length > 0">
            <div class="panel-heading">
                <h3 class="panel-title">Available datasets</h3>
            </div>
            <div class="panel-body">
                <p ng-show="datasets.length == 0">No named datasets found.</p>
                <ul class="list-unstyled" ng-show="datasets.length > 0">
                    <li ng-repeat="ds in datasets"><input type="checkbox" ng-model="ds.active" ng-change="changeDataset($index)" />&nbsp;{{ds.label.variants[language]}}</li>
                </ul>
            </div>
            <div class="panel-footer"></div>
        </div>

        <div ng-repeat="type in componentTypes">
            <ul class="list-group">
                <li class="list-group-item active">{{type.plural}} settings</li>
                <li ng-repeat="component in activeDSD.components | orderBy:'order'" ng-if="component[type.key]" class="list-group-item" ng-class="{'list-group-item-danger': values[component[type.key].uri].length == 0}">
                    <table>
                        <tr>
                            <td style="border-right: 1px solid #ddd; padding-right: 10px;">
                                <i class="glyphicon glyphicon-cog" ng-click="toggleDimensionSettings(component[type.key].uri)" ng-if="type.key != 'measure'" style="cursor: pointer;"></i>
                                <input type="checkbox" ng-click="toggleMeasure(component)" ng-if="type.key == 'measure'" ng-checked="component.isActive" />
                                <br/>
                                <span ng-if="type.key == 'dimension'"> ({{dimensionValuesActiveCount[component[type.key].uri] || 0}})</span>
                            </td>
                            <td style="padding-left: 10px;">
                                {{component.label.variants[language] || component.label.variants["en"] || component.label.variants[""] || component[type.key].uri}}
                            </td>
                        </tr>
                    </table>

                    <p ng-show="values[component[type.key].uri].length == 0"><br />This {{type.key}} has no values. That's why your chart is empty.</p>
                </li>
            </ul>
        </div>

        <div class="well well-sm">
            Labels:
            <ul class="list-unstyled" style="margin-bottom: 0px; display: inline-block;">
                <li ng-repeat="l in availableLanguages" style="display: inline; margin-right: 3px;"><span ng-click="setLang(l)" class="flag-icon flag-icon-{{l}}"></span></li>
            </ul>
        </div>
    </div>

    <div class="col-lg-9" ng-if="queryingDataset">
        <div class="alert alert-info">
            <p>
                <strong>Querying the dataset.</strong>
                Right now, we are querying the dataset for {{queryingDataset}}. It may take a few minutes based on the size of the result and/or size of the graf the query is running against.
            </p>
            <br /><br />
            <div class="progress">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                    <span class="sr-only">Almost complete</span>
                </div>
            </div>
        </div>
    </div>

    <div ng-if="!queryingDataset">
        <div class="col-lg-9" ng-if="settingsVisible">
            <div ng-repeat="component in activeDSD.components | orderBy:'order'" ng-if="component['dimension']">
                <div class="panel panel-default" ng-show="settingsVisible == component.dimension.uri">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            Values settings for <{{component.dimension.uri}}>
                            <div class="pull-right">
                                <button class="btn btn-default btn-xs" ng-click="toggleValues(component.dimension.uri)">Toggle</button>
                                <button class="btn btn-default btn-xs" ng-click="selectAllValues(component.dimension.uri)">Select all</button>
                                <button class="btn btn-default btn-xs" ng-click="deselectAllValues(component.dimension.uri)">Deselect all</button>
                            </div>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <ul class="list-unstyled">
                            <li ng-repeat="v in values[component.dimension.uri]"><input type="checkbox" ng-click="toggleDimensionValue(v)" ng-checked="v.isActive" />
                                {{v.label || v.uri}}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-9" ng-if="!settingsVisible">
            <div class="alert alert-danger" ng-show="dataStructures.length == 0"><p>The chosen datasource does not contain any DataCube vocabularies.</p></div>

            <div ng-if="activeDSD">
                <div ng-if="slicesSelected">

                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div clas="row">
                                <div class="col-lg-2" style="padding: 0;">
                                    <button class="btn btn-primary btn-block" ng-click="refresh()"><i class="glyphicon glyphicon-refresh"></i> Refresh</button>
                                </div>

                                <div class="col-lg-10">
                                    <input type="text" ng-model="permalink" class="form-control" readonly ng-if="permalink" />
                                </div>
                            </div>
                            <div class="row" style="margin-top: 45px;">
                                <div class="col-lg-12">
                                    <div class="btn-toolbar">
                                        <div class="btn-group">
                                            <button class="btn btn-default" ng-click="showChart()" ng-class="{'btn-success': chartVisible}"><i class="glyphicon glyphicon-signal"></i> Chart</button>
                                            <button class="btn btn-default" ng-click="showMap()" ng-class="{'btn-success': mapVisible}"><i class="glyphicon glyphicon-globe"></i> Map</button>
                                        </div>

                                        <div class="btn-group" ng-show="chartVisible">
                                            <button class="btn btn-default" ng-click="switchChart('line', true)" ng-class="{'btn-success':highcharts.options.chart.type == 'line'}">Line</button>
                                            <button class="btn btn-default" ng-click="switchChart('bar', true)" ng-class="{'btn-success':highcharts.options.chart.type == 'bar'}">Bar</button>
                                            <button class="btn btn-default" ng-click="switchChart('column', true)" ng-class="{'btn-success':highcharts.options.chart.type == 'column'}">Column</button>
                                            <button class="btn btn-default" ng-click="switchChart('area', true)" ng-class="{'btn-success':highcharts.options.chart.type == 'area'}">Area</button>
                                            <button class="btn btn-default" ng-disabled="highcharts.series.length > 1" ng-click="switchChart('pie', true); switchPolar(false, true);" ng-class="{'btn-success':highcharts.options.chart.type == 'pie'}">Pie</button>
                                        </div>
                                        <div class="btn-group" ng-show="chartVisible">
                                            <button class="btn btn-default" ng-click="switchPolar(true, true)" ng-class="{'btn-success':highcharts.options.chart.polar}">Polar</button>
                                            <button class="btn btn-default" ng-click="switchPolar(false, true)" ng-class="{'btn-success':!highcharts.options.chart.polar}">Normal</button>
                                        </div>
                                        <!--
                                        <div class="btn-group" ng-show="chartVisible">
                                            <button class="btn btn-default" ng-click="switchLinear()" ng-class="{'btn-success':highcharts.options.yAxis.type != 'logarithmic'}">Linear</button>
                                            <button class="btn btn-default" ng-click="switchLog()" ng-class="{'btn-success':highcharts.options.yAxis.type == 'logarithmic'}">Logarithmic</button>
                                        </div>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <highchart id="chart1" config="highcharts" ng-if="chartVisible" class="cubechart"></highchart>

                    <cz-region-map data="czRegionData" ng-if="mapVisible"></cz-region-map>
                </div>

                <div class="alert alert-info" ng-if="!slicesSelected">
                    <p>
                        <strong>Slicing not active!</strong>
                        To see charts, you need to make slices. To make slices, you have to select exactly one value on each dimension.
                        If you choose to display just one measure, you are able to select more values on up to 2 dimensions.
                        With more measures, you are able to select more values just on one dimension.
                    </p>
                </div>

                <div class="alert alert-info" ng-if="!slicesSelected">
                    <p>
                        You have selected {{measuresSelectedCount}} measure(s).
                        <span ng-if="measuresSelectedCount < 1">You need to select at least one measure.</span>
                        <span ng-if="measuresSelectedCount == 1">You may select multiple values on up to 2 dimensions to create slices.</span>
                        <span ng-if="measuresSelectedCount > 1">You may select multiple values on only 1 dimension to create slices.</span>
                    </p>
                </div>
            </div>

            <div class="alert alert-info" ng-if="!activeDSD">
                <p>
                    <strong>No DSD selected!</strong>
                    You need to choose a DSD to see charts.
                </p>
            </div>
        </div>
    </div>


</div>